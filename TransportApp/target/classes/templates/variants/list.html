<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Danh sách chặng</title>
    <th:block th:replace="base :: bootstrap"></th:block>
</head>
<body>
    <header th:replace="base :: header"></header>

    <main class="container mt-4">
        <h4 class="mb-3">Các chặng thuộc tuyến <span th:text="${routeId}"></span></h4>

        <div th:if="${routeId != null}">
            <a class="btn btn-primary mb-2"
               th:href="@{|/variants/add?routeId=${routeId}|}">
                + Thêm Chặng
            </a>
        </div>


        <form method="get" class="row mb-3">
            <div class="col-md-4">
                <input type="text" class="form-control" name="kw" th:value="${kw}" placeholder="Tìm theo tên tuyến..."/>
            </div>
            <div class="col-md-3">
                <select class="form-select" name="orderBy">
                    <option value="">-- Sắp xếp --</option>
                    <option value="seq" th:selected="${orderBy == 'seq'}">STT tuyến</option>
                    <option value="name" th:selected="${orderBy == 'name'}">Tên tuyến</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-success w-100">Lọc</button>
            </div>
        </form>

        <!-- Nếu có routeId -->
        <div th:if="${routeId != null}">
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Thuộc tuyến</th>
                        <th>Thứ tự</th>
                        <th>Điểm đầu</th>
                        <th>Điểm cuối</th>
                        <th style="width:160px"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="v, stat : ${variants}">
                        <td th:text="${stat.count}"></td>
                        <td th:text="${v.route.name}"></td>
                        <td th:text="${v.seq}"></td>
                        <td th:text="${v.startStop.name}"></td>
                        <td th:text="${v.endStop.name}"></td>
                        <td class="d-flex gap-1">
                            <a class="btn btn-sm btn-warning"
                               th:href="@{'/variants/edit/' + ${v.id}}">Sửa</a>
                            <a class="btn btn-sm btn-danger"
                               th:href="@{'/variants/delete/' + ${v.id}}"
                               onclick="return confirm('Xóa chặng này?');">Xóa</a>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(variants)}">
                        <td colspan="6" class="text-center">Chưa có chặng nào</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Nếu KHÔNG có routeId -->
        <div th:if="${routeId == null}">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Tên chặng</th>
                        <th>Thứ tự</th>
                        <th style="width:200px"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="v, stat : ${variants}">
                        <td th:text="${stat.count}"></td>
                        <td th:text="${v.name}">Bến Thành - Suối Tiên</td>
                        <td th:text="${v.seq}"></td>
                        <td>
                            <a class="btn btn-sm btn-info" th:href="@{|/schedules/add?variantId=${v.id}|}">Tạo lịch</a>
                            <a class="btn btn-sm btn-warning"
                               th:href="@{'/variants/edit/' + ${v.id}}">Sửa</a>
                            <a class="btn btn-sm btn-danger"
                               th:href="@{'/variants/delete/' + ${v.id}}"
                               onclick="return confirm('Xóa chặng này?');">Xóa</a>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(variants)}">
                        <td colspan="4" class="text-center">Không có dữ liệu</td>
                    </tr>
                </tbody>
            </table>
        </div>


        <a class="btn btn-secondary" th:href="@{/routes}">← Quay về danh sách tuyến</a>
    </main>

    <footer th:replace="base :: footer"></footer>
</body>
</html>
